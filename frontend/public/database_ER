<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Mô hình ER cho hệ thống xem phim</title>
  <!-- Sử dụng phiên bản ES Module của Mermaid từ CDN -->
  <script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
  </script>
  <!-- Nếu bạn gặp vấn đề với import module, có thể dùng cách sau (dạng non-module):
  <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
  <script>
    mermaid.initialize({ startOnLoad: true });
  </script>
  -->
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    h1 {
      text-align: center;
    }
    .mermaid {
      margin: 0 auto;
      max-width: 1000px;
    }
  </style>
</head>
<body>
  <h1>Mô hình ER cho hệ thống xem phim</h1>
  <div class="mermaid">
    erDiagram
    Users ||--o{ MovieComments : writes
    Users ||--o{ UserFavorites : favorites
    Users ||--o{ UserWatchHistories : watches
    Movies ||--o{ Episodes : contains
    Movies ||--o{ MovieComments : has_comments
    Movies ||--o{ UserFavorites : favored_by
    Movies ||--o{ UserWatchHistories : watched_by
    Movies ||--o{ MoviesGenres : has_genres
    Genres ||--o{ MoviesGenres : assigned_to
    Episodes ||--o{ UserWatchHistories : watched_episodes
  
    Users {
      serial id PK
      varchar full_name
      varchar email
      varchar password
      enum role "user|admin|subscriber"
      timestamp subscriptionExpiredAt
      timestamp createdAt
      timestamp updatedAt
    }
  
    Movies {
      serial id PK
      varchar title
      numeric rating
      integer views
      text summary
      integer duration
      integer totalEpisodes
      integer releaseYear
      varchar posterUrl
      varchar trailerUrl
      varchar playlistUrl
      timestamp createdAt
      timestamp updatedAt
    }
  
    Episodes {
      serial id PK
      integer movieId FK
      integer episodeNumber
      varchar playlistUrl
      integer views
      timestamp createdAt
      timestamp updatedAt
    }
  
    Genres {
      serial id PK
      varchar name
    }
  
    MoviesGenres {
      integer movieId FK
      integer genreId FK
    }
  
    MovieComments {
      serial id PK
      integer movieId FK
      integer userId FK
      varchar userName
      text comment
      timestamp createdAt
      timestamp updatedAt
    }
  
    UserFavorites {
      serial id PK
      integer userId FK
      integer movieId FK
      timestamp favoritedAt
      timestamp createdAt
      timestamp updatedAt
    }
  
    UserWatchHistories {
      serial id PK
      integer userId FK
      integer movieId FK
      integer episodeId FK
      timestamp watchedAt
      timestamp createdAt
      timestamp updatedAt
    }
  
  </div>
</body>
</html>
